(function(e){var a=e.History||{},g=e.history;if(typeof a.emulated!=="undefined")throw Error("History.js has already been emulated...");a.init=function(){console.info("History.init",this,arguments);a.emulated={pushState:!Boolean(e.history&&e.history.pushState&&e.history.replaceState),hashChange:Boolean(!("onhashchange"in e||"onhashchange"in document)||a.Adapter.getBrowserFlag()==="msie"&&a.Adapter.getBrowserMajorVersion()<8)};a.setHash=function(b){console.info("History.setHash",this,arguments);return document.location.hash=
b};a.getHash=function(){console.info("History.getHash",this,arguments);return a.extractHash(document.location.hash)};a.extractHash=function(b){console.info("History.extractHash",this,arguments);return String(b).replace(/^[^#]*#/,"").replace(/^#+|#+$/,"")};a.extractUrl=function(b){console.info("History.extractUrl",this,arguments);return String(b).replace(/^#+|#+$/,"")};a.getStateObject=function(b,d,c){console.info("History.getStateObject",this,arguments);return{data:b,title:d,url:c}};a.getStateHash=
function(b,d,c){console.info("History.getStateHash",this,arguments);return JSON.stringify(a.getStateObject(b,d,c))};a.currentState=a.getStateObject({},document.title,document.location.href);a.getState=function(){console.info("History.getState",this,arguments);return a.currentState};a.Adapter.bind(e,"popstate",function(b,d){console.info("History.popstate",this,arguments);var c={};if(b&&b.state)c=b.state;else if(b&&b.originalEvent&&b.originalEvent.state)c=b.originalEvent.state;else if(b&&b.memo&&b.memo.state)c=
b.memo.state;else if(d&&d.state)c=d.state;c=a.getStateObject(c,document.title,document.location.href);a.currentState=c;return true});a.pushStateAndTrigger=function(b,d,c){a.pushState(b,d,c);a.Adapter.trigger(e,"popstate",{state:b});return true};a.replaceStateAndTrigger=function(b,d,c){a.replaceState(b,d,c);a.Adapter.trigger(e,"popstate",{state:b});return true};if(a.emulated.pushState){a.Adapter.bind(e,"hashchange",function(b){console.info("History.hashchange",this,arguments);var d=unescape(a.extractHash(b.newURL||
document.location)),c=JSON.parse(d),f=a.getState();f=a.getStateHash(f.data,f.title,f.url);if(d===f)return false;if(a.discardedState(c)){g.go(-1);return false}a.pushState(c.data,c.title,c.url);return true});a.discardedStates={};a.discardState=function(b,d,c){console.info("History.discardState",this,arguments);var f=a.getStateHash(b,d,c);return a.discardedStates[f]=true};a.discardedState=function(b,d,c){console.info("History.discardedState",this,arguments);var f=a.getStateHash(b,d,c);return typeof a.discardedStates[f]!==
"undefined"};a.recycleState=function(b,d,c){console.info("History.recycleState",this,arguments);a.discardedState(b,d,c)&&delete a.discardedStates[StateHash];return true};a.pushState=function(b,d,c){console.info("History.pushState",this,arguments);a.recycleState(b,d,c);var f=a.getStateObject(b,d,c),h=a.getStateHash(b,d,c);h=escape(h);a.Adapter.trigger(e,"popstate",{state:f.data});a.currentState=f;a.getHash()!==h&&a.setHash(h);return true};a.replaceState=function(b,d){console.info("History.replaceState",
this,arguments);var c=a.getState();a.pushState(b,d,data);a.discardState(c.data,c.title,c.url);return true}}else{a.pushState=function(){g.pushState.apply(g,arguments)};a.replaceState=function(){g.replaceState.apply(g,arguments)};a.go=function(){g.go.apply(g,arguments)};a.back=function(){g.back.apply(g,arguments)};a.forward=function(){g.forward.apply(g,arguments)}}};typeof a.Adapter!=="undefined"&&a.init();e.History=a})(window);
